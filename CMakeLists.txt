cmake_minimum_required (VERSION 3.14.5)

project (Rays)

set (CMAKE_CXX_STANDARD 14)

############################################################################
# glm
############################################################################

include_directories (${CMAKE_CURRENT_SOURCE_DIR}/ext/glm/)

############################################################################
# nanogui
############################################################################

# Disable building extras we won't need (pure C++ project)
set (NANOGUI_BUILD_EXAMPLE OFF CACHE BOOL " " FORCE)
set (NANOGUI_BUILD_PYTHON  OFF CACHE BOOL " " FORCE)
set (NANOGUI_BUILD_SHARED  OFF CACHE BOOL " " FORCE)
set (NANOGUI_INSTALL       OFF CACHE BOOL " " FORCE)

# Add the configurations from nanogui
add_subdirectory (ext/nanogui)

# For reliability of parallel build, make the NanoGUI targets dependencies
set_property (TARGET glfw glfw_objects nanogui PROPERTY FOLDER "dependencies")

# Various preprocessor definitions have been generated by NanoGUI
add_definitions (${NANOGUI_EXTRA_DEFS})

# On top of adding the path to nanogui/include, you may need extras
include_directories (
	${CMAKE_CURRENT_SOURCE_DIR}/ext/nanogui/include
	${NANOGUI_EXTRA_INCS}
)

############################################################################
# tbb
############################################################################

# Build Thread Building Blocks (main shared libraries only)
set(TBB_BUILD_SHARED          OFF  CACHE BOOL " " FORCE)
set(TBB_BUILD_STATIC          ON  CACHE BOOL " " FORCE)
set(TBB_BUILD_TBBMALLOC       OFF CACHE BOOL " " FORCE)
set(TBB_BUILD_TBBMALLOC_PROXY OFF CACHE BOOL " " FORCE)
set(TBB_BUILD_TESTS           OFF CACHE BOOL " " FORCE)

add_subdirectory(ext/tbb)
set_property(TARGET tbb_static tbb_def_files PROPERTY FOLDER "dependencies")

include_directories (
	${CMAKE_CURRENT_SOURCE_DIR}/ext/tbb/include
)

############################################################################
# tinyobjloader
############################################################################

include_directories (
	${CMAKE_CURRENT_SOURCE_DIR}/ext/tinyobjloader
)

set (TINY_OBJ_LOADER_SOURCE
	${CMAKE_CURRENT_SOURCE_DIR}/ext/tinyobjloader/tiny_obj_loader.cpp
)

############################################################################
# Rays
############################################################################

include_directories (src/)

set (RAYS_SOURCE
	src/BlockGenerator.cpp
	src/DirectionalLight.cpp
	src/ImageBlock.cpp
	src/Main.cpp
	src/PointLight.cpp
	src/RaysApp.cpp
	src/Renderer.cpp
	src/Sphere.cpp
	src/Ray.cpp
	src/Camera.cpp
	src/Scene.cpp
	src/Whitted.cpp
)

add_executable (Rays ${RAYS_SOURCE} ${TINY_OBJ_LOADER_SOURCE})

target_link_libraries (Rays nanogui tbb_static ${NANOGUI_EXTRA_LIBS})